console.log("Last Updated 11-08-2022"),google.charts.load("current",{packages:["corechart"]}),google.charts.load("current",{packages:["corechart","controls"]}),google.charts.setOnLoadCallback(EnableSubmitButton);var submitButton=document.getElementById("submit-file"),selectedFiles=document.getElementById("open-file"),startDemo=document.getElementById("start-demo-file"),showEmojiImageTable=document.getElementById("emoji-table-replace"),statusDisplay={main:document.getElementById("status-display"),chartService:document.getElementById("status-googlechart-load"),analysing:document.getElementById("status-analysing"),complete:document.getElementById("status-complete")},Conversation={},Participants=[],TimeArrays={Day:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Month:["January","February","March","April","May","June","July","August","September","October","November","December"]},timeDisplay="Hours",fullDateDisplay="Months",wordsDisplay=15,wordsLengthMin=1,wordsLengthMax=20,emojisDisplay=20,messageLengthsDisplay=0,latin_map={à:"a",è:"e",ì:"i",ò:"o",ù:"u",À:"A",È:"E",Ì:"I",Ò:"O",Ù:"U",á:"a",é:"e",í:"i",ó:"o",ú:"u",ý:"y",Á:"A",É:"E",Í:"I",Ó:"O",Ú:"U",Ý:"Y",â:"a",ê:"e",î:"i",ô:"o",û:"u",ð:"o",Â:"A",Ê:"E",Î:"I",Ô:"O",Û:"U",Ð:"D",ã:"a",ñ:"n",õ:"o",Ã:"A",Ñ:"N",Õ:"O",ä:"a",ë:"e",ï:"i",ö:"o",ü:"u",ÿ:"y",Ä:"A",Ë:"E",Ï:"I",Ö:"O",Ü:"U",Ÿ:"Y",å:"a",Å:"A",æ:"ae",œ:"oe",Æ:"AE",Œ:"OE",ß:"B",ç:"c",Ç:"C",ø:"o",Ø:"O","\xbf":"?","\xa1":"!"},LatiniseString=Object.keys(latin_map).join(""),mainDataCategories=["TimeData","MessageLengths","WordsSent","EmojisSent"],timeSubData=["Day","Month","Year","Time","Fulldate"];startDemo.addEventListener("click",function(){fetch("./files/demofile.json").then(function(a){return a.json()}).then(function(a){AnalyseConversation(a)}).catch(function(){console.log("Oops! Didn't get demo file.")})});var conversationParts=[];function extendConversationPart(a,b){for(let c of(""===a.title&&(a.title=b.title),""===a.thread_type&&(a.thread_type=b.thread_type),a.messages.push(...b.messages),b.participants))a.participants.includes(c)||a.participants.push(c);return a}function readFile(a){if(a>selectedFiles.files.length-1){AnalyseConversation(conversationParts.reduce((a,b)=>extendConversationPart(a,b)));return}let b=new FileReader;b.onload=function(){var b=JSON.parse(this.result,(b,a)=>"participants"===b?a.map(a=>a.name):a);conversationParts.push(b),readFile(a+1)},b.readAsText(selectedFiles.files[a])}function BuildChartDivs(){mainDataCategories.forEach(a=>{"TimeData"==a?timeSubData.forEach(b=>{CreateSingleChartDiv(a,b)}):CreateSingleChartDiv(a,null)}),InsertTableDivs(),CreateChartButtonEvents(),CreateTimeToggleEvents(),InsertWordChartOptions(),InsertMessageLengthChartOptions()}function CreateSingleChartDiv(c,a){var d=document.getElementById("chart-container");a?d.innerHTML+=`<div class="mda-spacer"></div>
            <div id="container-${c}-${a}" class="mda-chart">
                <div class="d-flex">
                    <h4 class="chart-title">No Data to Chart :(</h4>
                    <div class="btn-group ml-auto">
                        <button type="button" class="active btn btn-outline-dark btn-sm btn-normal-cols">Normal Columns</button>
                        <button type="button" class="btn btn-outline-dark btn-sm btn-stacked-cols">Stacked Columns</button>
                        <button type="button" class="btn btn-outline-dark btn-sm btn-100-cols">100% Stacked Columns</button>
                    </div>
                </div>
                <div class="d-flex d-row justify-content-center">
                    <div id="chart-${c}-${a}"></div>
                </div>
            </div>`:d.innerHTML+=`<div class="mda-spacer"></div>
            <div id="container-${c}" class="mda-chart">
                <div class="d-flex">
                    <h4 class="chart-title">No Data to Chart :(</h4>
                    <div class="btn-group ml-auto">
                        <button type="button" class="active btn btn-outline-dark btn-sm btn-normal-cols">Normal Columns</button>
                        <button type="button" class="btn btn-outline-dark btn-sm btn-stacked-cols">Stacked Columns</button>
                        <button type="button" class="btn btn-outline-dark btn-sm btn-100-cols">100% Stacked Columns</button>
                    </div>
                </div>
                <div class="d-flex d-row justify-content-center">
                    <div id="chart-${c}"></div>
                </div>
            </div>`,("Time"==a||"Fulldate"==a)&&(d.querySelector(`#container-${c}-${a} div.btn-group`).classList.remove("ml-auto"),d.querySelector(`#container-${c}-${a} div.btn-group`).classList.add("ml-2"));var e=a?document.getElementById(`container-${c}-${a}`).querySelector("div"):document.getElementById(`container-${c}`).querySelector("div");if("Time"==a){var b=document.createElement("button"),f=e.querySelector(".btn-group");b.id="TimeToggleBtn",b.classList.add("btn","btn-outline-dark","btn-sm","ml-auto"),b.innerHTML="Group by 15 minutes",e.insertBefore(b,f)}else if("Fulldate"==a){var b=document.createElement("button"),f=e.querySelector(".btn-group");b.id="FulldateToggleBtn",b.classList.add("btn","btn-outline-dark","btn-sm","ml-auto"),b.innerHTML="Group by Days",e.insertBefore(b,f)}}function CreateChartButtonEvents(){var a=document.querySelectorAll(".btn-normal-cols"),b=document.querySelectorAll(".btn-stacked-cols"),c=document.querySelectorAll(".btn-100-cols");a.forEach(a=>{a.addEventListener("click",function(){for(let b of a.parentNode.children)b.classList.remove("active");a.classList.add("active");var[c,d]=a.parentElement.parentElement.parentElement.id.replace("container-","").split("-");ChartData(c,d,{isStacked:!1})})}),b.forEach(a=>{a.addEventListener("click",function(){for(let b of a.parentNode.children)b.classList.remove("active");a.classList.add("active");var[c,d]=a.parentElement.parentElement.parentElement.id.replace("container-","").split("-");ChartData(c,d,{isStacked:!0})})}),c.forEach(a=>{a.addEventListener("click",function(){for(let b of a.parentNode.children)b.classList.remove("active");a.classList.add("active");var[c,d]=a.parentElement.parentElement.parentElement.id.replace("container-","").split("-");ChartData(c,d,{isStacked:"percent"})})})}function CreateTimeToggleEvents(){document.getElementById("TimeToggleBtn").addEventListener("click",function(){"Minutes"==timeDisplay?(timeDisplay="Hours",document.getElementById("TimeToggleBtn").innerHTML="Group by 15 minutes"):(timeDisplay="Minutes",document.getElementById("TimeToggleBtn").innerHTML="Group by Hours"),ChartData("TimeData","Time")}),document.getElementById("FulldateToggleBtn").addEventListener("click",function(){"Months"==fullDateDisplay?(fullDateDisplay="Days",document.getElementById("FulldateToggleBtn").innerHTML="Group by Months"):(fullDateDisplay="Months",document.getElementById("FulldateToggleBtn").innerHTML="Group by Days"),ChartData("TimeData","Fulldate")})}function InsertTableDivs(){var a=document.getElementById("container-WordsSent");a.innerHTML+=`<div id="WordsSent-dashboard" class="text-center">
        <h5><u>Filter for Words sent</u></h5>
        <div id="WordsSent-filter"></div>
        <div id="WordsSent-table"></div>
    </div>`,a=document.getElementById("container-EmojisSent"),a.innerHTML+=`<div id="EmojisSent-dashboard" class="text-center">
        <h5><u>Filter for Emojis sent</u></h5>
        <div id="EmojisSent-filter"></div>
        <div id="EmojisSent-table"></div>
        <a href="javascript:void(0);" class="my-2" data-toggle="modal" data-target="#emoji-modal">Having trouble seeing emojis?</a>
    </div>
    <table id="emoji-image-table" class="table-sm table-striped table-bordered text-center" style="margin: auto!important;" hidden>
        <thead id="emoji-image-table-head" class="bg-primary text-light">
            <th class="px-2">Rank</th>
            <th class="px-2">Emoji</th>
        </thead>
        <tbody id="emoji-image-table-body">
        </tbody>
    </table>`}function InsertWordChartOptions(){var b=document.getElementById("chart-WordsSent").parentElement.parentElement,c=document.getElementById("chart-WordsSent").parentElement,a=document.createElement("div");a.innerHTML='<p>Word length: <input id="words-min" type="number" name="quantity" value="1" class="form-control d-inline-block w-05"></input> to <input id="words-max" type="number" name="quantity" value="20" class="form-control d-inline-block w-05"> characters.</p>',a.classList.add("d-flex","flex-row-reverse","text-right","mt-2"),b.insertBefore(a,c);var d=document.getElementById("words-min"),e=document.getElementById("words-max");d.addEventListener("change",function(){wordsLengthMin=parseInt(d.value),ChartData("WordsSent")}),e.addEventListener("change",function(){wordsLengthMax=parseInt(e.value),ChartData("WordsSent")})}function InsertMessageLengthChartOptions(){var b=document.getElementById("chart-MessageLengths").parentElement.parentElement,c=document.getElementById("chart-MessageLengths").parentElement,a=document.createElement("div");a.innerHTML='<p>Chart limit: <input id="lengths-max" type="number" name="quantity" value="0" class="form-control d-inline-block w-05"> words long.</p>',a.classList.add("d-flex","flex-row-reverse","text-right","mt-2"),b.insertBefore(a,c);var d=document.getElementById("lengths-max");d.addEventListener("change",function(){messageLengthsDisplay=Number(d.value),ChartData("MessageLengths",null)})}function ConversationReset(){Participants=[],(Conversation={})._AddTimeData=function(a,b){ObjectAddNewValueOrIncrement(this[b].TimeData.Day,a.Day),ObjectAddNewValueOrIncrement(this[b].TimeData.Month,a.Month),ObjectAddNewValueOrIncrement(this[b].TimeData.Year,a.Year),ObjectAddNewValueOrIncrement(this[b].TimeData.Time.Minutes,a.Time.Minutes),ObjectAddNewValueOrIncrement(this[b].TimeData.Time.Hours,a.Time.Hours),ObjectAddNewValueOrIncrement(this[b].TimeData.Fulldate.Days,a.Fulldate.Days),ObjectAddNewValueOrIncrement(this[b].TimeData.Fulldate.Months,a.Fulldate.Months),ObjectAddNewValueOrIncrement(this.ConversationTotals.TimeData.Day,a.Day),ObjectAddNewValueOrIncrement(this.ConversationTotals.TimeData.Month,a.Month),ObjectAddNewValueOrIncrement(this.ConversationTotals.TimeData.Year,a.Year),ObjectAddNewValueOrIncrement(this.ConversationTotals.TimeData.Time.Minutes,a.Time.Minutes),ObjectAddNewValueOrIncrement(this.ConversationTotals.TimeData.Time.Hours,a.Time.Hours),ObjectAddNewValueOrIncrement(this.ConversationTotals.TimeData.Fulldate.Days,a.Fulldate.Days),ObjectAddNewValueOrIncrement(this.ConversationTotals.TimeData.Fulldate.Months,a.Fulldate.Months)},Conversation._AddContentTypeData=function(a,b){ObjectAddNewValueOrIncrement(this[b].MessageContentTypes,a),ObjectAddNewValueOrIncrement(this.ConversationTotals.MessageContentTypes,a)},Conversation._AddWordData=function(a,b){a.forEach(a=>{ObjectAddNewValueOrIncrement(this[b].WordsSent,a),ObjectAddNewValueOrIncrement(this.ConversationTotals.WordsSent,a)})},Conversation._AddEmojiData=function(a,b){a.forEach(a=>{ObjectAddNewValueOrIncrement(this[b].EmojisSent,a),ObjectAddNewValueOrIncrement(this.ConversationTotals.EmojisSent,a)})},Conversation._AddMessageLengthData=function(a,b){ObjectAddNewValueOrIncrement(this[b].MessageLengths,a),ObjectAddNewValueOrIncrement(this.ConversationTotals.MessageLengths,a)}}function AnalyseConversation(a){var d=performance.now();ConversationReset(),Conversation.ConversationTitle=a.title,InitialiseConversation(a.participants);var b=performance.now();console.log("Init done: "+(b-d).toFixed(2)+" milliseconds"),Conversation.ConversationTotals.MessagesSentCount=a.messages.length,a.messages.forEach(a=>{try{Conversation[a.sender_name].MessagesSentCount+=1}catch(h){InitaliseParticipant(a.sender_name),Conversation[a.sender_name].MessagesSentCount+=1}var d=TimeAnalysis(a.timestamp_ms);Conversation._AddTimeData(d,a.sender_name);var b=ContentTypeAnalysis(a);if(Conversation._AddContentTypeData(b,a.sender_name),"Text Messages"===b){var c=GetMessageContentArray(decodeURIComponent(escape(a.content))),e=a.content.split(" ").length;Conversation._AddMessageLengthData(e,a.sender_name);var f=MessageWordsAnalysis(c);Conversation._AddWordData(f,a.sender_name);var g=MessageEmojiAnalysis(c);Conversation._AddEmojiData(g,a.sender_name)}});var c=performance.now();console.log("Analysis done: "+(c-b).toFixed(2)+" milliseconds"),console.log("Raw Data:",Conversation),document.querySelector("#analysis-results").removeAttribute("hidden"),0!==Object.keys(Conversation.ConversationTotals.TimeData.Fulldate).length&&(ChartData("TimeData","Day"),ChartData("TimeData","Month"),ChartData("TimeData","Year"),ChartData("TimeData","Time"),ChartData("TimeData","Fulldate")),0!==Object.keys(Conversation.ConversationTotals.MessageLengths).length&&ChartData("MessageLengths"),0!==Object.keys(Conversation.ConversationTotals.WordsSent).length&&(ChartData("WordsSent"),ChartPieData("MessagesSentCount"),ChartPieData("WordsSentCount"),CreateMessageTypesInfoTable(),CreateParticipantWordInfoTable()),0!==Object.keys(Conversation.ConversationTotals.EmojisSent).length&&ChartData("EmojisSent"),WriteConversationInfo(),statusDisplay.analysing.setAttribute("hidden",!0),statusDisplay.complete.removeAttribute("hidden");var e=performance.now();console.log("Charting done: "+(e-c).toFixed(2)+" milliseconds")}function InitialiseConversation(a){InitaliseParticipant("ConversationTotals"),a.forEach(a=>{InitaliseParticipant(a)})}function InitaliseParticipant(a){Participants.push(a),Conversation[a]={},Conversation[a].MessagesSentCount=0,Conversation[a].TimeData={},Conversation[a].TimeData.Day=new Object,Conversation[a].TimeData.Month=new Object,Conversation[a].TimeData.Year=new Object,Conversation[a].TimeData.Time=new Object,Conversation[a].TimeData.Time.Minutes=new Object,Conversation[a].TimeData.Time.Hours=new Object,Conversation[a].TimeData.Fulldate=new Object,Conversation[a].TimeData.Fulldate.Days=new Object,Conversation[a].TimeData.Fulldate.Months=new Object,Conversation[a].MessageContentTypes=new Object,Conversation[a].MessageLengths=new Object,Conversation[a].WordsSent=new Object,Conversation[a].EmojisSent=new Object}function TimeAnalysis(d){var b=new Date(d),a={};a.Day=TimeArrays.Day[b.getDay()],a.Month=TimeArrays.Month[b.getMonth()],a.Year=b.getFullYear();var e,f=b.getHours(),c=b.getMinutes();c=1==String(e=c).length?"00":e.toString()[0]+"0",a.Time={},a.Time.Minutes=new Date(2018,1,1).setHours(f,c,0,0),a.Time.Hours=new Date(2018,1,1).setHours(f,0,0,0);var g=new Date(d).setHours(1,0,0,0);return a.Fulldate={},a.Fulldate.Days=g,a.Fulldate.Months=new Date(g).setDate(1),a}function ContentTypeAnalysis(a){if(a.sticker)return"Stickers";if(a.videos)return"Videos";if(a.photos)return"Photos";if(a.files)return"Files";if(a.gifs)return"GIFs";if(a.share||"Share"==a.type)return"Shared Links";if(a.audio_files)return"Audio Files";else if(a.plan)return"Plan (linked date/time)";else if(a.content)return"Text Messages";else return"Link to External Site"}function GetMessageContentArray(a){return a.replace(/( :\))/g," \u{1F642} ").replace(/( <\("\))/g," \u{1F427} ").replace(/( :\()/g," \u{1F61E} ").replace(/( :\/)/g," \u{1F615} ").replace(/( :P)/g," \u{1F61B} ").replace(/ :D/g," \u{1F600} ").replace(/ :o/g," \u{1F62E} ").replace(/ ;\)/g," \u{1F609} ").replace(/ B-\)/g," \u{1F60E} ").replace(/ >:\(/g," \u{1F620} ").replace(/ :'\(/g," \u{1F622} ").replace(/ 3:\)/g," \u{1F608} ").replace(/ O:\)/gi," \u{1F607} ").replace(/ :\*/g," \u{1F617} ").replace(/<3/g," \u2764 ").replace(/\^_\^/g," \u{1F60A} ").replace(/-_-/g," \u{1F611} ").replace(/ >:O/gi," \u{1F620} ").replace(/\(y\)/gi," \u{1F44D} ").toLowerCase().replace(/['"]\s+/g,"").replace(/\s+['"]/g,"").replace(/[.,/\\#!$%^&*;:{}=\-_`"~()[\]@?+><]/g,"").replace(/\s+/g," ").split(" ")}function MessageEmojiAnalysis(a){var d=new RegExp("[^\\w\u2018\u2019\u201C\u201D'"+LatiniseString+"]","g"),b=a.filter(a=>a.match(d)),c=[],e=new GraphemeSplitter;return b.forEach(a=>{e.splitGraphemes(a).filter(a=>a.match(d)).forEach(a=>{escape(unescape(encodeURIComponent(a))).match(/%E2%9D%A4/gi)&&(a="\u2764"),c.push(a)})}),c}function MessageWordsAnalysis(b){var d=new RegExp("[\\w\u2018\u2019\u201C\u201D'"+LatiniseString+"]","g"),e=new RegExp("[^\\w\u2018\u2019\u201C\u201D'"+LatiniseString+"]","g"),c=b.filter(a=>a.match(d)),a=[];return c.forEach(b=>{a.push(b.replace(e,""))}),a=a.filter(function(a){return a})}function ChartData(a,b=null,i=null){var j,c,d=new google.visualization.DataTable,m=palette("mpn65",Participants.length),r=[];if("Time"==b)d.addColumn("datetime","Time");else if("Fulldate"==b)d.addColumn("date","Date");else if("MessageLengths"==a)d.addColumn("number","Length");else{var s=GetColumnDisplayName(a,b);d.addColumn("string",s)}var y=0;if(m.unshift("6d6d6d"),Participants.forEach(a=>{r.push("fill-color:"+m[y]+";fill-opacity: 0.6;stroke-color:"+m[y]+";stroke-width: 0.5;"),d.addColumn("number",a),d.addColumn({type:"string",role:"style"}),y++}),b){SetTimeArrays(a,b),TimeArrays[b].forEach(e=>{var c=[];"Time"==b||"Fulldate"==b?c.push(new Date(Number(e))):c.push(String(e)),y=0,Participants.forEach(d=>{"Time"==b?c.push(Conversation[d][a][b][timeDisplay][e]):"Fulldate"==b?c.push(Conversation[d][a][b][fullDateDisplay][e]):c.push(Conversation[d][a][b][e]),c.push(r[y]),y++}),d.addRow(c)});try{GetTooltipFormat(b).format(d,0)}catch(z){console.log("No tooltip formatting required for "+b+".")}j=document.getElementById("chart-"+a+"-"+b)}else{var k=Object.keys(Conversation.ConversationTotals[a]);if("MessageLengths"==a){var t=Math.max(...k=ArrayString2Number(k));messageLengthsDisplay<=0&&(document.getElementById("lengths-max").value=t),messageLengthsDisplay=Number(document.getElementById("lengths-max").value)}for(var u of k){var v=NonTimeDataRow(u,a,r);d.addRow(v)}if("WordsSent"==a||"EmojisSent"==a)switch(d.sort([{column:1,desc:!0}]),c=new google.visualization.DataView(d),a){case"WordsSent":var l=GetWordsFilteredRows(c);c.getNumberOfRows()<wordsDisplay?c.setRows([...Array(c.getNumberOfRows()).keys()]):c.setRows(l.slice(0,wordsDisplay));break;case"EmojisSent":emojisDisplay=20,c.getNumberOfRows()<emojisDisplay?(c.setRows([...Array(c.getNumberOfRows()).keys()]),emojisDisplay=c.getNumberOfRows()):c.setRows([...Array(emojisDisplay).keys()])}j=document.getElementById("chart-"+a)}if("WordsSent"==a||"EmojisSent"==a){var n=new google.visualization.Dashboard(document.getElementById(a+"-dashboard")),e=new google.visualization.DataView(d);if("WordsSent"==a){var l=GetWordsFilteredRows(e);e.setRows(l)}var g=[0].concat([...Array(d.getNumberOfColumns()).keys()].filter(a=>a%2));e.setColumns(g);var w=new google.visualization.ControlWrapper({controlType:"StringFilter",containerId:a+"-filter",options:{filterColumnIndex:0}}),x=new google.visualization.ChartWrapper({chartType:"Table",containerId:a+"-table",options:{showRowNumber:!0,page:"enable",pageSize:10,allowHtml:!0,cssClassNames:{tableCell:"emoji-font",headerRow:"bg-primary text-light"}}});n.bind([w],[x]),n.draw(e),"EmojisSent"==a&&CreateEmojisImageTable(e)}var h=GetChartOptions(a,b,m);if(i)for(var f in i)h[f]=i[f];var o=CheckChartColumnOptions(a,b);for(var f in o)h[f]=o[f];var p=GetChartTitle(a,b);b?document.getElementById(`container-${a}-${b}`).querySelector(".chart-title").innerHTML=p:document.getElementById(`container-${a}`).querySelector(".chart-title").innerHTML=p;var q=new google.visualization.ColumnChart(j);if(c){var g=[...Array(d.getNumberOfColumns()).keys()];g.splice(1,1),c.setColumns(g),q.draw(c,h)}else d.removeColumn(1),q.draw(d,h)}function ChartPieData(b){var c=document.getElementById("chart-"+b),a=new google.visualization.DataTable;a.addColumn("string","Person"),a.addColumn("number","Sent");var d=palette("mpn65",Participants.length);Participants.forEach(c=>{var d;"ConversationTotals"!=c&&(d="MessagesSentCount"==b?Conversation[c].MessagesSentCount:SumObjectValues(Conversation[c].WordsSent),a.addRow([c,d]))});var e=GetChartOptions(b,null,d),f=new google.visualization.PieChart(c);f.draw(a,e)}function GetColumnDisplayName(a,b){switch(a){case"TimeData":break;case"WordsSent":return"Words";case"EmojisSent":return"Emojis"}switch(b){case"Day":return"Day";case"Month":return"Month";case"Year":return"Year"}}function GetTooltipFormat(a){return"Time"==a&&"Minutes"==timeDisplay?new google.visualization.DateFormat({pattern:"h:mm aa"}):"Time"==a&&"Hours"==timeDisplay?new google.visualization.DateFormat({pattern:"h aa"}):"Fulldate"==a&&"Months"==fullDateDisplay?new google.visualization.DateFormat({pattern:"MMMM, YYYY"}):void 0}function SetTimeArrays(b,a){switch(a){case"Day":case"Month":break;case"Year":var d=Math.min(...Object.keys(Conversation.ConversationTotals[b][a])),e=Math.max(...Object.keys(Conversation.ConversationTotals[b][a]));TimeArrays[a]=[];for(let c=d;c<=e;c++)TimeArrays[a].push(String(c));break;case"Time":"Hours"==timeDisplay?TimeArrays[a]=Object.keys(Conversation.ConversationTotals[b][a].Hours):TimeArrays[a]=Object.keys(Conversation.ConversationTotals[b][a].Minutes);break;case"Fulldate":"Days"==fullDateDisplay?TimeArrays[a]=Object.keys(Conversation.ConversationTotals[b][a].Days):TimeArrays[a]=Object.keys(Conversation.ConversationTotals[b][a].Months)}}function NonTimeDataRow(b,c,d){var a=[];a.push(b);var e=0;return Participants.forEach(f=>{a.push(Conversation[f][c][b]),a.push(d[e]),e++}),a}function GetChartOptions(f,d,b){var a={};"6d6d6d"==b[0]&&b.shift();var c=document.getElementById("marketing-cards").offsetWidth,e=.5*c;if(a.width=.9*c,a.height=.6*c,a.legend={position:"bottom"},a.chartArea={width:"100%",height:"80%",left:"8%"},a.colors=b,a.hAxis={baselineColor:"transparent",gridlines:{color:"transparent"}},a.vAxis={minValue:0},d)switch(d){case"Day":case"Month":case"Year":case"Fulldate":return a;case"Time":return a.hAxis.format="h a",a.hAxis.minValue=new Date(new Date(2018,1,1).setHours(0,0,0,0)),a.hAxis.maxValue=new Date(new Date(2018,1,1).setHours(23,59,0,0)),a.hAxis.title="Time of Day",a}else switch(f){case"MessageLengths":return a.hAxis.viewWindow={min:0,max:messageLengthsDisplay},a.hAxis.title="Message Length",a;case"WordsSent":return a;case"EmojisSent":return a.hAxis.textStyle={fontName:"Segoe UI Emoji",fontSize:18},a.tooltip={textStyle:{fontName:window.navigator.platform.includes("Mac")?"Apple Color Emoji":"Segoe UI Emoji"}},a;case"MessagesSentCount":case"WordsSentCount":return a.width=.9*e,a.height=.6*e,a.legend={position:""},a.titleTextStyle={fontSize:18},a}}function GetChartTitle(b,a){if(a)switch(a){case"Day":return"Messages by Day of the Week";case"Month":return"Messages by Month of the Year";case"Year":return"Messages by Year";case"Time":return"Messages by Time of Day, grouped by "+timeDisplay;case"Fulldate":return"Messages by date sent, grouped by "+fullDateDisplay}else switch(b){case"MessageLengths":return"Lengths of Messages Sent";case"WordsSent":return`Top ${wordsDisplay} Words by frequency, ${wordsLengthMin} to ${wordsLengthMax} letters long`;case"EmojisSent":return"Top 20 Emojis by frequency";case"MessagesSentCount":return"Messages Sent";case"WordsSentCount":return"Words Sent"}}function GetWordsFilteredRows(a){return a.getFilteredRows([{column:0,test:function(a,b,c,d){return a.length>=wordsLengthMin&&a.length<=wordsLengthMax}}])}function CreateMessageTypesInfoTable(){var a=document.getElementById("message-types-info-body");a.innerHTML="",Participants.forEach(b=>{if("ConversationTotals"!=b){var c=void 0===Conversation[b].MessageContentTypes["Text Messages"]?0:Conversation[b].MessageContentTypes["Text Messages"],d=void 0===Conversation[b].MessageContentTypes.Photos?0:Conversation[b].MessageContentTypes.Photos,e=void 0===Conversation[b].MessageContentTypes.Videos?0:Conversation[b].MessageContentTypes.Videos,f=void 0===Conversation[b].MessageContentTypes.Stickers?0:Conversation[b].MessageContentTypes.Stickers,g=void 0===Conversation[b].MessageContentTypes.GIFs?0:Conversation[b].MessageContentTypes.GIFs,h=void 0===Conversation[b].MessageContentTypes.Files?0:Conversation[b].MessageContentTypes.Files,i=void 0===Conversation[b].MessageContentTypes["Shared Links"]?0:Conversation[b].MessageContentTypes["Shared Links"],j=void 0===Conversation[b].MessageContentTypes["Audio Files"]?0:Conversation[b].MessageContentTypes["Audio Files"],k=void 0===Conversation[b].MessageContentTypes["Plan (linked date/time)"]?0:Conversation[b].MessageContentTypes["Plan (linked date/time)"],l=`<td>${b}</td><td>${c}</td><td>${d}</td><td>${e}</td><td>${f}</td><td>${g}</td><td>${h}</td><td>${i}</td><td>${j}</td><td>${k}</td>`;a.insertAdjacentHTML("beforeend",`<tr>${l}</tr>`)}})}function CreateParticipantWordInfoTable(){var a=document.getElementById("participant-words-info-body");a.innerHTML="",Participants.forEach(b=>{if("ConversationTotals"!=b){var c=Conversation[b].MessagesSentCount,d=SumObjectValues(Conversation[b].WordsSent),e=`<td>${b}</td><td>${c}</td><td>${d}</td><td>${(d/c).toFixed(2)}</td>`;a.insertAdjacentHTML("beforeend",`<tr>${e}</tr>`)}})}function CreateEmojisImageTable(c){document.getElementById("emoji-image-table-head").innerHTML=`<th class="px-2">Rank</th>
    <th class="px-2">Emoji</th>`;var b=document.getElementById("emoji-image-table-body");b.innerHTML="";var f=document.querySelector("#emoji-image-table-head>tr");Participants.forEach(a=>{f.insertAdjacentHTML("beforeend",`<th class="px-2">${a}</th>`)});for(let a=0;a<emojisDisplay;a++){var d=c.getValue(a,0),e=`<td>${a+1}</td><td>${emojione.toImage(d)}</td>`;Participants.forEach(d=>{var b=Participants.indexOf(d)+1,f=null==c.getValue(a,b)?0:c.getValue(a,b);e+=`<td>${f}</td>`}),b.insertAdjacentHTML("beforeend",`<tr>${e}</tr>`)}}function WriteConversationInfo(){var a=Conversation.ConversationTotals.MessagesSentCount,b=SumObjectValues(Conversation.ConversationTotals.WordsSent),c=Object.keys(Conversation.ConversationTotals.WordsSent).length,d=SumObjectValues(Conversation.ConversationTotals.EmojisSent),e=Object.keys(Conversation.ConversationTotals.EmojisSent).length;document.getElementById("conversation-info").innerHTML=`<p><strong>Total Messages: </strong>${a.toLocaleString()}</p>
    <p><strong>Total Words: </strong>${b.toLocaleString()}</p>
    <p><strong>Unique Words: </strong>${c.toLocaleString()}</p>
    <p><strong>Total Emojis: </strong>${d.toLocaleString()}</p>
    <p><strong>Unique Emojis: </strong>${e.toLocaleString()}</p>`}function ObjectAddNewValueOrIncrement(a,b){a[b]?a[b]+=1:a[b]=1}function ColorHexToRGBOpacity(a,b){var a=a.replace("#",""),c=parseInt(a.substring(0,2),16),d=parseInt(a.substring(2,4),16),e=parseInt(a.substring(4,6),16);return`rgba(${c}, ${d}, ${e}, ${b})`}function ArrayString2Number(a){var b=[];return a.forEach(a=>{b.push(Number(a))}),b}function EnableSubmitButton(){document.getElementById("submit-file").removeAttribute("disabled"),statusDisplay.chartService.setAttribute("hidden",!0)}function SumObjectValues(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&(b+=parseInt(a[c]));return b}function ChangeFileSelectLabel(){document.getElementById("open-file-label").innerText=`${selectedFiles.files.length} Files`,document.getElementById("open-file-label").classList.add("text-success")}function CheckChartColumnOptions(d,e){var a={};if(e){let f="container-"+d+"-"+e,b=document.getElementById(f).querySelector(".active");b.classList.contains("btn-normal-cols")?a.isStacked=!1:b.classList.contains("btn-stacked-cols")?a.isStacked=!0:b.classList.contains("btn-100-cols")&&(a.isStacked="percent")}else{let g="container-"+d,c=document.getElementById(g).querySelector(".active");c.classList.contains("btn-normal-cols")?a.isStacked=!1:c.classList.contains("btn-stacked-cols")?a.isStacked=!0:c.classList.contains("btn-100-cols")&&(a.isStacked="percent")}return a}submitButton.addEventListener("click",function(){readFile(0),statusDisplay.analysing.removeAttribute("hidden"),statusDisplay.complete.setAttribute("hidden",!0)}),selectedFiles.addEventListener("change",function(){ChangeFileSelectLabel()}),showEmojiImageTable.addEventListener("click",function(){document.getElementById("emoji-image-table").removeAttribute("hidden")}),BuildChartDivs()